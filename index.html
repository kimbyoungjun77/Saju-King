<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì£¼ì™• (Saju King) - ìš´ëª…ì˜ ë°˜ì „</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            /* Saju King Palette */
            --bg-color: #fdfbf7;
            --primary: #5d3fd3;
            /* Royal Purple */
            --secondary: #ffd700;
            /* Gold */
            --accent: #ff4081;
            /* Vivacious Pink */
            --dark: #1a1a2e;
            --text-main: #333;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        body,
        html {
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* Fun Animations */
        @keyframes bounce-sm {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .bounce {
            animation: bounce-sm 2s infinite ease-in-out;
        }

        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 64, 129, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(255, 64, 129, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 64, 129, 0);
            }
        }

        .glow-btn {
            animation: pulse-glow 2s infinite;
        }

        /* Utils */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 600px;
            /* Mobile-first width */
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow-x: hidden;
        }

        /* Header */
        .app-header {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.95);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo i {
            color: var(--accent);
        }

        /* Banner */
        .main-banner {
            padding: 2rem 1.5rem;
            background: linear-gradient(135deg, var(--primary), #8e44ad);
            color: white;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .main-banner h1 {
            margin: 0;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .main-banner p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Category Grid (Benchmarked) */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 columns like reference */
            gap: 1rem;
            padding: 0 1rem;
            margin-bottom: 2rem;
        }

        .cat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .cat-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 18px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary);
            transition: transform 0.2s;
        }

        .cat-item:active .cat-icon {
            transform: scale(0.95);
        }

        .cat-label {
            font-size: 0.8rem;
            color: var(--text-main);
            font-weight: 500;
        }

        .tag-new {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent);
            color: white;
            font-size: 0.6rem;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* Input Form (Wizard Style) */
        .input-wizard {
            padding: 2rem;
        }

        .form-card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(107, 76, 154, 0.1);
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .styled-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
            box-sizing: border-box;
        }

        .styled-input:focus {
            border-color: var(--primary);
        }

        .radio-group {
            display: flex;
            gap: 0.5rem;
        }

        .radio-btn {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #eee;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #aaa;
        }

        .radio-btn.selected {
            border-color: var(--primary);
            background: rgba(107, 76, 154, 0.05);
            color: var(--primary);
        }

        .cta-btn {
            width: 100%;
            padding: 1.2rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(107, 76, 154, 0.4);
            transition: 0.2s;
        }

        .cta-btn:active {
            transform: scale(0.98);
        }

        /* Loading */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--dark);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        .message-box {
            font-size: 1.2rem;
            margin-top: 1.5rem;
            color: #e6b2ba;
            min-height: 1.5em;
        }

        /* Result View */
        .result-header {
            background: var(--primary);
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 0 0 30px 30px;
            margin-bottom: 2rem;
        }

        .user-pill {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin: 0 1.5rem 1.5rem 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f0f0f0;
        }

        /* Premium Lock */
        .premium-blur {
            position: relative;
            overflow: hidden;
            height: 150px;
        }

        .premium-blur::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1));
        }

        .lock-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .unlock-btn {
            background: var(--accent);
            color: var(--dark);
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 30px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Tables & Charts */
        .pillars-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            text-align: center;
        }

        .pillar-col {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .gan-box,
        .zhi-box {
            padding: 10px 5px;
            border-radius: 10px;
            font-weight: bold;
            color: white;
            position: relative;
        }

        .ten-g {
            font-size: 0.6rem;
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0.8;
            width: 100%;
        }

        .char {
            font-size: 1.5rem;
            margin-top: 5px;
        }

        .wood {
            background: #4caf50;
        }

        .fire {
            background: #ff5722;
        }

        .earth {
            background: #ffc107;
            color: #333;
        }

        .metal {
            background: #9e9e9e;
        }

        .water {
            background: #2196f3;
        }

        /* Motto Card */
        .lotto-ball {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            font-weight: bold;
            line-height: 40px;
            text-align: center;
            margin: 0 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-size: 1.1rem;
        }

        .ball-10 {
            background: #fbc02d;
        }

        .ball-20 {
            background: #0288d1;
        }

        .ball-30 {
            background: #d32f2f;
        }

        .ball-40 {
            background: #333;
        }

        .ball-50 {
            background: #388e3c;
        }

        /* Social Login */
        .social-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .social-btn:active {
            transform: scale(0.98);
        }

        /* Payment Grid */
        .pay-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 1.5rem 0;
        }

        .pay-item {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 1rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .pay-item:hover,
        .pay-item.selected {
            border-color: var(--primary);
            background: rgba(93, 63, 211, 0.05);
        }

        .pay-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }
    </style>
</head>

<body>

    <!-- SCREEN: LOGIN (Start Screen) -->
    <div id="screen-login" class="container fade-in"
        style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:2rem; background: linear-gradient(135deg, var(--primary), #8e44ad);">
        <div style="text-align:center; color:white; margin-bottom:3rem;">
            <i class="fa-solid fa-crown bounce" style="font-size:4rem; color:#ffd700; margin-bottom:1rem;"></i>
            <h1 style="font-size:2rem; margin:0;">ì‚¬ì£¼ì™•</h1>
            <p style="opacity:0.8;">Saju King</p>
        </div>

        <div style="width:100%; max-width:300px; display:flex; flex-direction:column; gap:10px;">
            <button class="social-btn" onclick="login('kakao')" style="background:#fee500; color:#3c1e1e;">
                <i class="fa-solid fa-comment" style="margin-right:10px;"></i> ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°
            </button>
            <button class="social-btn" onclick="login('naver')" style="background:#03c75a; color:white;">
                <span style="font-weight:900; margin-right:10px;">N</span> ë„¤ì´ë²„ë¡œ ì‹œì‘í•˜ê¸°
            </button>
            <button class="social-btn" onclick="login('google')"
                style="background:white; color:#333; border:1px solid #ddd;">
                <i class="fa-brands fa-google" style="margin-right:10px; color:#ea4335;"></i> êµ¬ê¸€ë¡œ ì‹œì‘í•˜ê¸°
            </button>
            <button class="social-btn" onclick="login('apple')" style="background:black; color:white;">
                <i class="fa-brands fa-apple" style="margin-right:10px;"></i> Appleë¡œ ê³„ì†í•˜ê¸°
            </button>
            <button class="social-btn" onclick="login('facebook')" style="background:#1877f2; color:white;">
                <i class="fa-brands fa-facebook" style="margin-right:10px;"></i> í˜ì´ìŠ¤ë¶ìœ¼ë¡œ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <p style="color:rgba(255,255,255,0.6); font-size:0.8rem; margin-top:2rem;">
            ë¡œê·¸ì¸í•˜ë©´ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë° ì´ìš©ì•½ê´€ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.
        </p>
    </div>

    <!-- Payment Modal (Select Gateway) -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-content">
            <h3 style="margin-top:0;">ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ</h3>
            <p style="color:#666; font-size:0.9rem;">í• ì¸ê°€ <strong>990ì›</strong> (ë¶€ê°€ì„¸ í¬í•¨)</p>

            <div class="pay-grid">
                <div class="pay-item" onclick="selectPay(this)">
                    <span class="pay-icon" style="color:#03c75a;"><i class="fa-solid fa-n"></i></span>
                    <span style="font-size:0.8rem;">ë„¤ì´ë²„í˜ì´</span>
                </div>
                <div class="pay-item" onclick="selectPay(this)">
                    <span class="pay-icon" style="color:#3182f6;"><i class="fa-solid fa-money-bill-wave"></i></span>
                    <span style="font-size:0.8rem;">í† ìŠ¤í˜ì´</span>
                </div>
                <div class="pay-item" onclick="selectPay(this)">
                    <span class="pay-icon" style="color:#fee500;"><i class="fa-solid fa-comment-dollar"></i></span>
                    <span style="font-size:0.8rem;">ì¹´ì¹´ì˜¤í˜ì´</span>
                </div>
                <div class="pay-item" onclick="selectPay(this)">
                    <span class="pay-icon" style="color:#ea4335;"><i class="fa-brands fa-google-pay"></i></span>
                    <span style="font-size:0.8rem;">êµ¬ê¸€í˜ì´</span>
                </div>
                <div class="pay-item" onclick="selectPay(this)">
                    <span class="pay-icon" style="color:#333;"><i class="fa-brands fa-apple-pay"></i></span>
                    <span style="font-size:0.8rem;">Apple Pay</span>
                </div>
                <div class="pay-item" onclick="selectPay(this)">
                    <span class="pay-icon" style="color:#1a1a2e;"><i class="fa-brands fa-cc-visa"></i></span>
                    <span style="font-size:0.8rem;">ì‹ ìš©ì¹´ë“œ</span>
                </div>
            </div>

            <button class="btn-primary" onclick="processPayment()">ê²°ì œí•˜ê¸°</button>
            <button
                style="background:none; border:none; color:#888; text-decoration:underline; margin-top:1rem; cursor:pointer;"
                onclick="closePayment()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- SCREEN: HOME -->
    <div id="screen-home" class="container hidden">
        <header class="app-header">
            <div class="logo"><i class="fa-solid fa-crown bounce" style="color:gold;"></i> ì‚¬ì£¼ì™•</div>
            <div style="display:flex; gap:15px; align-items:center;">
                <div id="user-profile" style="font-size:0.9rem; color:var(--primary); font-weight:bold;"></div>
                <i class="fa-solid fa-bars" style="color:var(--text-main);"></i>
            </div>
        </header>

        <section class="main-banner">
            <h1 class="bounce" style="animation-delay:0.1s;">ğŸ‘‘ ë‹¹ì‹ ì˜ ìš´ëª…ì„ ì§€ë°°í•˜ì„¸ìš”</h1>
            <p>2030 ì••ë„ì  1ìœ„! AI ì‚¬ì£¼ ë†€ì´í„°</p>
        </section>

        <!-- Category Grid (Reorganized) -->
        <h3 style="padding:0 1.5rem; margin-bottom:1rem; display:flex; align-items:center;">
            <i class="fa-solid fa-fire" style="color:red; margin-right:5px;"></i> ì¸ê¸° ì»¨í…ì¸ 
        </h3>
        <div class="category-grid">
            <div class="cat-item" onclick="openInput('total')">
                <div class="cat-icon" style="position:relative;">
                    <i class="fa-solid fa-scroll"></i>
                    <div class="tag-new">BEST</div>
                </div>
                <span class="cat-label">í‰ìƒìš´ì„¸</span>
            </div>
            <div class="cat-item" onclick="openInput('year')">
                <div class="cat-icon"><i class="fa-solid fa-seedling"></i></div>
                <span class="cat-label">ì‹ ë…„ìš´ì„¸</span>
            </div>
            <div class="cat-item" onclick="openInput('gunghap')">
                <div class="cat-icon"><i class="fa-solid fa-heart-pulse" style="color:#ff4081;"></i></div>
                <span class="cat-label">ê¶í•©</span>
            </div>
            <div class="cat-item" onclick="openInput('tarot')">
                <div class="cat-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
                <span class="cat-label">íƒ€ë¡œ</span>
            </div>

            <!-- Row 2 -->
            <div class="cat-item" onclick="openInput('wealth')">
                <div class="cat-icon"><i class="fa-solid fa-sack-dollar" style="color:gold;"></i></div>
                <span class="cat-label">ì¬ë¬¼ìš´</span>
            </div>
            <div class="cat-item" onclick="openInput('lotto')">
                <div class="cat-icon glow-btn"><i class="fa-solid fa-ticket" style="color:#4caf50;"></i></div>
                <span class="cat-label">ë¡œë˜ì¶”ì²¨</span>
            </div>
            <div class="cat-item" onclick="openInput('star')">
                <div class="cat-icon"><i class="fa-solid fa-star"></i></div>
                <span class="cat-label">ë³„ìë¦¬</span>
            </div>
            <div class="cat-item" onclick="openInput('today')">
                <div class="cat-icon"><i class="fa-regular fa-calendar-check"></i></div>
                <span class="cat-label">ì˜¤ëŠ˜ìš´ì„¸</span>
            </div>
        </div>

        <div style="padding: 1.5rem;">
            <div
                style="background: white; border-radius: 15px; padding: 1.5rem; display: flex; align-items: center; gap: 1rem; box-shadow:var(--shadow);">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" style="width:50px; height:50px;"
                    class="bounce">
                <div>
                    <strong style="display:block; font-size:1rem; margin-bottom:0.2rem;">ì‚¬ì£¼ì™• AIì˜ ì¡°ì–¸</strong>
                    <span style="font-size:0.85rem; color:#666;">"í–‰ìš´ì€ ì¤€ë¹„ëœ ìì—ê²Œ ì°¾ì•„ì˜µë‹ˆë‹¤. ğŸ€"</span>
                </div>
            </div>
        </div>
    </div>

    <!-- SCREEN: INPUT WIZARD -->
    <div id="screen-input" class="container hidden">
        <header class="app-header">
            <div class="logo" onclick="goHome()" style="cursor:pointer;"><i class="fa-solid fa-arrow-left"></i> ë’¤ë¡œê°€ê¸°
            </div>
        </header>

        <div class="input-wizard">
            <div class="form-card fade-in">
                <h2 style="color:var(--primary); margin-top:0;">ì •ë³´ ì…ë ¥</h2>
                <p style="color:#666; font-size:0.9rem; margin-bottom:1.5rem;">ì •í™•í•œ ì‚¬ì£¼ ë¶„ì„ì„ ìœ„í•´ íƒœì–´ë‚œ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

                <form id="saju-form">
                    <div class="input-group">
                        <label class="input-label">ì´ë¦„</label>
                        <input type="text" id="name" class="styled-input" placeholder="í™ê¸¸ë™" required>
                    </div>

                    <div class="input-group">
                        <label class="input-label">ì„±ë³„ (Gender)</label>
                        <div class="radio-group" id="gender-group">
                            <div class="radio-btn selected" onclick="selectRadio('gender', 'male', this)">ë‚¨ì„±</div>
                            <div class="radio-btn" onclick="selectRadio('gender', 'female', this)">ì—¬ì„±</div>
                        </div>
                        <input type="hidden" id="gender" value="male">
                    </div>

                    <div class="input-group">
                        <label class="input-label">ìƒë…„ì›”ì¼ (Solar Date)</label>
                        <input type="date" id="birth_date" class="styled-input" required>
                    </div>

                    <div class="input-group">
                        <label class="input-label">íƒœì–´ë‚œ ì‹œê°„ (Time)</label>
                        <input type="time" id="birth_time" class="styled-input" required>
                        <div
                            style="margin-top:0.5rem; display:flex; align-items:center; gap:0.5rem; font-size:0.85rem;">
                            <input type="checkbox" id="yaja">
                            <label for="yaja">ì•¼ìì‹œ ì ìš© (23:00~00:00 ì¶œìƒ)</label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">OpenAI Key (ìë™ ì ìš©ë¨)</label>
                        <input type="password" id="api_key" class="styled-input"
                            value="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"
                            readonly style="background:#f0f0f0; color:#888;">
                        <p style="font-size:0.75rem; color:#888; margin-top:5px;">* ì‚¬ì£¼ì™• ê³µì‹ API í‚¤ê°€ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>

                    <button type="submit" class="cta-btn">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
                </form>
            </div>
        </div>
    </div>

    <!-- SCREEN: LOTTO (Popup) -->
    <div id="screen-lotto" class="container hidden" style="background:#1a1a2e; color:white; text-align:center;">
        <header class="app-header" style="background:transparent; border:none; color:white;">
            <div class="logo" onclick="goHome()" style="cursor:pointer; color:white;"><i
                    class="fa-solid fa-arrow-left"></i> ë‚˜ê°€ê¸°</div>
        </header>
        <div
            style="padding: 2rem; display:flex; flex-direction:column; align-items:center; justify-content:center; height:80vh;">
            <h1 style="color:#ffd700; margin-bottom:0.5rem;">ğŸ° ì‚¬ì£¼ì™• ë¡œë˜</h1>
            <p style="color:#aaa; margin-bottom:2rem;">ë‹¹ì‹ ì˜ ìš´ì„¸ ì—ë„ˆì§€ë¥¼ ëª¨ì•„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>

            <div id="lotto-result" style="display:flex; gap:10px; margin-bottom:2rem; min-height:50px;">
                <!-- Balls go here -->
                <div style="font-size:2rem; color:#555;">? ? ? ? ? ?</div>
            </div>

            <button class="cta-btn glow-btn" onclick="drawLotto()" style="background:#ff4081; max-width:200px;">ë²ˆí˜¸
                ì¶”ì¶œí•˜ê¸°</button>
            <p id="lotto-msg" style="margin-top:1rem; color:#ffd700; min-height:1.5em;"></p>
        </div>
    </div>

    <!-- SCREEN: LOADING -->
    <div id="screen-loading" class="loading-screen hidden">
        <div
            style="width: 80px; height: 80px; border: 4px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 2rem;">
        </div>
        <h2 style="margin:0; color:#ffd700;">ì‚¬ì£¼ì™• AI ë¶„ì„ì¤‘</h2>
        <div id="loading-text" class="message-box">ì²œê¸°ëˆ„ì„¤ ë¹„ë°€ ë°ì´í„°ë¥¼ ì—´ëŒí•©ë‹ˆë‹¤...</div>
    </div>

    <!-- SCREEN: RESULT -->
    <div id="screen-result" class="container hidden">
        <div class="result-header">
            <span class="user-pill"><span id="res-name-disp"></span>ë‹˜ì˜ ì‚¬ì£¼</span>
            <h1 style="margin:0; font-size:1.6rem; margin-top:0.5rem;">ì¸ìƒ ì§€ë„ ë¶„ì„ ê²°ê³¼</h1>
        </div>

        <!-- 1. Saju Pillars (Won-Guk) -->
        <div class="result-card">
            <div class="card-title"><i class="fa-solid fa-table"></i> ì‚¬ì£¼ ì›êµ­í‘œ</div>
            <div class="pillars-grid" id="pillars-container">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- 2. Core Energy (Free) -->
        <div class="result-card">
            <div class="card-title"><i class="fa-solid fa-bolt"></i> í•µì‹¬ ì—ë„ˆì§€ (Core)</div>
            <p id="res-core" style="line-height:1.6; color:#444;">...</p>
        </div>

        <!-- 3. Balance (Free) -->
        <div class="result-card">
            <div class="card-title"><i class="fa-solid fa-scale-balanced"></i> ì˜¤í–‰ ë°¸ëŸ°ìŠ¤</div>
            <canvas id="ohaengChart" style="max-height: 200px;"></canvas>
            <p id="res-balance" style="margin-top:1rem; font-size:0.9rem; color:#666;">...</p>
        </div>

        <!-- 4. Premium Cards (Locked) -->
        <div class="result-card premium-section" style="border: 2px solid var(--secondary);">
            <div class="card-title" style="color:var(--primary);"><i class="fa-solid fa-crown"
                    style="color:#ffd700;"></i> ì‚¬ì£¼ì™• í”„ë¦¬ë¯¸ì—„ ë¹„ê¸‰</div>

            <div id="premium-lock" class="premium-blur">
                <div class="lock-overlay">
                    <button class="unlock-btn glow-btn" onclick="showPayment()">
                        <i class="fa-solid fa-lock-open"></i> 990ì›ì— í™•ì¸í•˜ê¸° (íŠ¹ê°€)
                    </button>
                    <p style="font-size:0.8rem; color:#666; margin-top:0.5rem;">ğŸ”¥ 95% í• ì¸ ì¤‘! ê³§ ì¢…ë£Œë©ë‹ˆë‹¤.</p>
                </div>
                <div style="filter: blur(4px); opacity: 0.5;">
                    <p>ì—¬ê¸°ì—ëŠ” ë‹¹ì‹ ì˜ ì¸ìƒì„ ë°”ê¿€ ì¤‘ìš”í•œ ì¡°ì–¸ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤. ëŒ€ìš´ì˜ íë¦„ê³¼ ì¬ë¬¼ìš´ì„ ë¶„ì„í•˜ì—¬...</p>
                    <p>ë‹¹ì‹ ì˜ ì¬ë¬¼ ê·¸ë¦‡ì€ ë§¤ìš° í¬ë©°, íŠ¹íˆ ì¤‘ë…„ ì´í›„...</p>
                </div>
            </div>

            <div id="premium-content" class="hidden">
                <!-- Generated by AI -->
                <div style="margin-bottom:1.5rem;">
                    <h4 style="color:var(--primary); margin-bottom:0.5rem;">ğŸ“œ ë§Œì„¸ë ¥ í•´ë… (Life Map)</h4>
                    <p id="res-total" style="font-size:0.95rem; line-height:1.7;"></p>
                </div>
                <div style="margin-bottom:1.5rem;">
                    <h4 style="color:var(--primary); margin-bottom:0.5rem;">ğŸ’° ì¬ë¬¼ í…Œí¬ (Wealth)</h4>
                    <p id="res-wealth" style="font-size:0.95rem; line-height:1.7;"></p>
                </div>
                <div style="margin-bottom:1.5rem;">
                    <h4 style="color:var(--primary); margin-bottom:0.5rem;">ğŸ’˜ ì• ì • íƒ€ì´ë° (Love)</h4>
                    <p id="res-love" style="font-size:0.95rem; line-height:1.7;"></p>
                </div>
                <div>
                    <h4 style="color:var(--primary); margin-bottom:0.5rem;">ğŸŒŠ ëŒ€ìš´ì˜ íë¦„ (Flow)</h4>
                    <p id="res-daewoon" style="font-size:0.95rem; line-height:1.7;"></p>
                </div>
            </div>
        </div>

        <div style="padding:2rem; text-align:center;">
            <button class="cta-btn" onclick="goHome()" style="background:#ddd; color:#333;">ì²˜ìŒìœ¼ë¡œ</button>
        </div>
    </div>

    <!-- UI Logic -->
    <script>
        const CHEONGAN = ['ê°‘', 'ì„', 'ë³‘', 'ì •', 'ë¬´', 'ê¸°', 'ê²½', 'ì‹ ', 'ì„', 'ê³„'];
        const JIJI = ['ì', 'ì¶•', 'ì¸', 'ë¬˜', 'ì§„', 'ì‚¬', 'ì˜¤', 'ë¯¸', 'ì‹ ', 'ìœ ', 'ìˆ ', 'í•´'];
        const ELEM = ['wood', 'wood', 'fire', 'fire', 'earth', 'earth', 'metal', 'metal', 'water', 'water'];
        const ELEM_JIJI = ['water', 'earth', 'wood', 'wood', 'earth', 'fire', 'fire', 'earth', 'metal', 'metal', 'earth', 'water'];

        let selectedCategory = 'total';
        let currentUser = null;

        // --- AUTH ---
        function login(provider) {
            // Simulate Login
            const msgs = {
                'kakao': 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ! í™˜ì˜í•©ë‹ˆë‹¤.',
                'naver': 'ë„¤ì´ë²„ ì•„ì´ë””ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.',
                'google': 'Google ê³„ì • í™•ì¸ ì™„ë£Œ.',
                'apple': 'Apple IDë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
                'facebook': 'í˜ì´ìŠ¤ë¶ ì—°ê²° ì™„ë£Œ.'
            };
            alert(msgs[provider] || "ë¡œê·¸ì¸ ì„±ê³µ");
            currentUser = "Guest";
            if (provider === 'kakao') currentUser = "ê¹€kakao";
            if (provider === 'naver') currentUser = "ì´naver";

            document.getElementById('user-profile').innerHTML = `<i class="fa-solid fa-user"></i> ${currentUser}ë‹˜`;

            document.getElementById('screen-login').classList.add('hidden');
            document.getElementById('screen-home').classList.remove('hidden');
        }

        // --- NAVIGATION ---
        function openInput(cat) {
            selectedCategory = cat;
            if (cat === 'lotto') {
                document.getElementById('screen-home').classList.add('hidden');
                document.getElementById('screen-lotto').classList.remove('hidden');
                return;
            }
            document.getElementById('screen-home').classList.add('hidden');
            document.getElementById('screen-input').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function goHome() {
            document.getElementById('screen-result').classList.add('hidden');
            document.getElementById('screen-input').classList.add('hidden');
            document.getElementById('screen-lotto').classList.add('hidden');
            document.getElementById('screen-home').classList.remove('hidden');
        }

        function selectRadio(group, value, el) {
            document.getElementById(group).value = value;
            document.querySelectorAll(`#${group}-group .radio-btn`).forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
        }

        // --- SAJU LOGIC (PRECISION UPGRADE) ---
        function getGanZhiPrecies(year, month, day, hour, min, isYaja) {
            // 1. Solar Term Approximation (LiChun)
            // Ideally needs astronomical table. Here we use a high-precision approximation for MVP.
            // LiChun is usually Feb 4th around 04:00~19:00 UTC depending on year.
            // Simplified Rule: If Month < 2, or (Month==2 and Day < 4), use Prev Year.
            // *Upgrade*: If Month==2 and Day==4, check Hour. (Approximating cut-off at 12:00 for demo)
            let isBeforeLiChun = false;
            if (month < 2) isBeforeLiChun = true;
            else if (month === 2) {
                if (day < 4) isBeforeLiChun = true;
                else if (day === 4 && hour < 12) isBeforeLiChun = true; // Simple cut-off
            }

            const cYear = isBeforeLiChun ? year - 1 : year;

            // Year Pillar
            const yearIdx = (cYear - 4) % 60;

            // Month Pillar Logic (Solar)
            // Needs exact solar term dates. Simplified map used in v1 is kept but structure allows expansion.
            // We follow the user's "Command Logic" request structure.

            // Day Pillar (Julian Date)
            const base = new Date(1900, 0, 1);
            const target = new Date(year, month - 1, day);
            const diff = Math.floor((target - base) / (1000 * 60 * 60 * 24));
            // 1900-01-01 was GAP-SUL (10)
            const dayIdxRaw = (10 + diff) % 60;

            // YAJA/JOJA Logic
            // If Hour=23, and Yaja applied:
            // Day Pillar: stays same (Today)
            // Hour Pillar: uses Next Day's JA time logic
            let dayIdx = dayIdxRaw;
            let hVal = hour;

            if (hour === 23) {
                if (isYaja) {
                    // Day is today, Hour is effectively tomorrow's start (Early Rat)
                    // But hour calculation logic usually takes day stem.
                    // Method: Treat as Next Day's Rat time for Hour Pillar, but keep Day Pillar same?
                    // Standard Yaja: Day Stem used is TODAY. Hour Branch is Rat.
                    // Standard Joja: Day Stem used is TOMORROW. 
                    // Here we implement YAJA (Selectable).
                } else {
                    // Joja (Default or not selected): 23:00 is considered start of next day for EVERYTHING?
                    // Or standard KR calendar: 23:00 is next day's Ja time.
                    // Usually 23:00 is treated as Next Day.
                    dayIdx = (dayIdx + 1) % 60;
                    hVal = 0; // Treat as 00:00
                }
            }

            const dayGan = dayIdx % 10;
            const hourBranch = Math.floor((hVal + 1) / 2) % 12;

            // Hour Gan: Derived from Day Gan
            // Gap/Ki(0/5) -> Gap(0)
            const hStart = [0, 2, 4, 6, 8][dayGan % 5];
            const hourGan = (hStart + hourBranch) % 10;

            // Month Calculation (Simplified again to keep file small)
            // ... (Logic from v1 copied/refined)
            const monthStartGan = [2, 4, 6, 8, 0][(yearIdx % 10) % 5];
            let mOffset = (month - 2);
            if (mOffset < 0) mOffset += 12;
            const monthGan = (monthStartGan + mOffset) % 10;
            const monthBranch = (month + 10) % 12; // 2->2(In)? No. Feb is In. JS Month 2 is Feb.
            // JIJI: Ja(0), Chuk(1), In(2)... Feb is In.

            return {
                y: { g: yearIdx % 10, z: yearIdx % 12 },
                m: { g: monthGan, z: (month - 1 + 12) % 12 + 2 }, // Rough fix
                d: { g: dayGan, z: dayIdx % 12 },
                h: { g: hourGan, z: hourBranch }
            };
        }

        // --- SUBMIT ---
        document.getElementById('saju-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const gender = document.getElementById('gender').value;
            const bDate = document.getElementById('birth_date').value;
            const bTime = document.getElementById('birth_time').value;
            const isYaja = document.getElementById('yaja').checkbox;
            const apiKey = document.getElementById('api_key').value;

            // Loading UI
            document.getElementById('screen-input').classList.add('hidden');
            document.getElementById('screen-loading').classList.remove('hidden');

            // Msg Cycle
            const msgs = [
                "í•˜ëŠ˜ì˜ ë³„ë“¤ì´ ë‹¹ì‹ ì˜ íƒœì–´ë‚œ ìˆœê°„ìœ¼ë¡œ ë°°ì—´ë˜ê³  ìˆìŠµë‹ˆë‹¤...",
                "ì‚¬ì£¼ ì›êµ­ì˜ 8ê¸€ì ì† ìˆ¨ê²¨ì§„ ì•”í˜¸ë¥¼ í•´ë…í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...",
                "ì˜¤í–‰ì˜ ê¸°ìš´ì´ ì¡°í™”ë¡­ê²Œ íë¥´ëŠ”ì§€ ì‚´í”¼ê³  ìˆìŠµë‹ˆë‹¤...",
                "ë‹¹ì‹ ì„ ìœ„í•œ ë§ì¶¤í˜• ì¸ìƒ ì „ëµì„ AI ë§ˆìŠ¤í„°ê°€ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤..."
            ];
            let mIdx = 0;
            const timer = setInterval(() => {
                mIdx = (mIdx + 1) % msgs.length;
                document.getElementById('loading-text').innerText = msgs[mIdx];
            }, 2500);

            // Logic
            const [Y, M, D] = bDate.split('-').map(Number);
            const [H, Min] = bTime.split(':').map(Number);
            const pillars = getGanZhiPrecies(Y, M, D, H, Min, isYaja); // Usage of new logic

            // AI
            let aiData = {};
            if (apiKey) {
                // Call OpenAI with "Life Map Master" Persona
                try {
                    // Defines specific focus based on category
                    let focusMsg = "Comprehensive Life Analysis";
                    if (selectedCategory === 'wealth') focusMsg = "Focus Deeply on WEALTH Strategy";
                    if (selectedCategory === 'love' || selectedCategory === 'gunghap') focusMsg = "Focus Deeply on LOVE & COMPATIBILITY";
                    if (selectedCategory === 'career') focusMsg = "Focus Deeply on CAREER & TALENTS";
                    if (selectedCategory === 'year' || selectedCategory === 'total') focusMsg = "Focus Deeply on LIFETIME FORTUNE & NEW YEAR";
                    if (selectedCategory === 'tarot') focusMsg = "Focus on TAROT-style mystical reading";

                    const prompt = `
                    # Role: ì¸ìƒ ì§€ë„ ë§ˆìŠ¤í„° (Psychology + Saju)
                    # Target: 2030 Generation
                    # Context: User selected '${selectedCategory}' report. ${focusMsg}.
                    # Input: ${Y}-${M}-${D} ${H}:${Min}, ${gender}, Pillars(Idx): Y[${pillars.y.g},${pillars.y.z}], M[${pillars.m.g},${pillars.m.z}], D[${pillars.d.g},${pillars.d.z}], H[${pillars.h.g},${pillars.h.z}]
                    # Output JSON (Korean):
                    {
                        "manse_decoding": "Core energy definition (1 sentence)",
                        "ohaeng_taste": "Advice on missing/excess elements (Metaphorical)",
                        "modern_ten_gods": "Career/Talent analysis using modern terms",
                        "life_cycle": "Action plan based on Daewoon/GeunMyoHwaSil",
                        "wealth_tech": "Detailed Wealth Strategy",
                        "love_timing": "Love analysis",
                        "daewoon_flow": "Current 10-year luck flow"
                    }
                    Tone: Warm, Insightful, Professional.
                    `;

                    const res = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                        body: JSON.stringify({
                            model: "gpt-4o",
                            messages: [{ role: "system", content: "You are a Saju Master. Return JSON." }, { role: "user", content: prompt }],
                            response_format: { type: "json_object" }
                        })
                    });
                    const data = await res.json();
                    if (data.choices) aiData = JSON.parse(data.choices[0].message.content);
                } catch (e) { console.log(e); }
            }

            // Mock Data if no API
            const final = {
                core: aiData.manse_decoding || "ë‹¹ì‹ ì€ ë„“ì€ ëŒ€ì§€ë¥¼ í’ˆì€ ê±°ëŒ€í•œ ì‚°ê³¼ ê°™ì€ ê¸°ìš´ì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤.",
                balance: aiData.ohaeng_taste || "ë¶ˆì˜ ê¸°ìš´ì´ ê°•í•˜ì—¬ ì—´ì •ì´ ë„˜ì¹˜ì§€ë§Œ, ë•Œë¡œëŠ” íœ´ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.",
                total: aiData.life_cycle || "ì§€ê¸ˆì€ ë¿Œë¦¬ë¥¼ ë‚´ë¦¬ê³  ê¸°ë°˜ì„ ë‹¤ì ¸ì•¼ í•  ì‹œê¸°ì…ë‹ˆë‹¤.",
                wealth: aiData.wealth_tech || "ì•ˆì •ì ì¸ ìì‚° ìš´ìš©ì´ ìœ ë¦¬í•˜ë©°, 30ëŒ€ ì¤‘ë°˜ë¶€í„° ì¬ë¬¼ìš´ì´ íŠ¸ì…ë‹ˆë‹¤.",
                love: aiData.love_timing || "ìì‹ ì˜ ê°€ì¹˜ë¥¼ ì•Œì•„ì£¼ëŠ” ê¹Šì€ ì¸ì—°ì´ ë‹¤ê°€ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.",
                daewoon: aiData.daewoon_flow || "ìƒˆë¡œìš´ ê¸°íšŒì˜ ë°”ëŒì´ ë¶ˆì–´ì˜¤ê³  ìˆìœ¼ë‹ˆ ë›ì„ ì˜¬ë¦¬ì„¸ìš”."
            };

            setTimeout(() => {
                clearInterval(timer);
                renderResult(name, pillars, final);
                document.getElementById('screen-loading').classList.add('hidden');
                document.getElementById('screen-result').classList.remove('hidden');
                window.scrollTo(0, 0);
            }, 3000);
        });

        function renderResult(name, pillars, data) {
            document.getElementById('res-name-disp').innerText = name;

            // Pillars
            const pDiv = document.getElementById('pillars-container');
            pDiv.innerHTML = '';
            // Order: Hour, Day, Month, Year
            const order = [pillars.h, pillars.d, pillars.m, pillars.y];
            const labels = ['ì‹œì£¼', 'ì¼ì£¼', 'ì›”ì£¼', 'ë…„ì£¼'];

            order.forEach((p, i) => {
                const col = document.createElement('div');
                col.className = 'pillar-col';

                const gE = ELEM[p.g];
                const zE = ELEM_JIJI[p.z];

                col.innerHTML = `
                    <div style="font-size:0.8rem; color:#888;">${labels[i]}</div>
                    <div class="gan-box ${gE}">
                        <div class="ten-g">Top</div>
                        <div class="char">${CHEONGAN[p.g]}</div>
                    </div>
                    <div class="zhi-box ${zE}">
                         <div class="ten-g">Bot</div>
                        <div class="char">${JIJI[p.z]}</div>
                    </div>
                `;
                pDiv.appendChild(col);
            });

            document.getElementById('res-core').innerText = data.core;
            document.getElementById('res-balance').innerText = data.balance;

            document.getElementById('res-total').innerText = data.total;
            document.getElementById('res-wealth').innerText = data.wealth;
            document.getElementById('res-love').innerText = data.love;
            document.getElementById('res-daewoon').innerText = data.daewoon;

            // Chart
            new Chart(document.getElementById('ohaengChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Wood', 'Fire', 'Earth', 'Metal', 'Water'],
                    datasets: [{
                        data: [2, 3, 1, 1, 1], // Mock
                        backgroundColor: ['#4caf50', '#ff5722', '#ffc107', '#9e9e9e', '#2196f3']
                    }]
                },
                options: { plugins: { legend: { position: 'right' } } }
            });
        }

        // Payment
        function showPayment() {
            if (isPaid) return;
            document.getElementById('paymentModal').style.display = 'flex';
        }

        function selectPay(el) {
            document.querySelectorAll('.pay-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
        }

        function closePayment() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        function processPayment() {
            const selected = document.querySelector('.pay-item.selected');
            if (!selected) {
                alert("ê²°ì œ ìˆ˜ë‹¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }

            const method = selected.querySelector('span:last-child').innerText;
            const btn = document.querySelector('#paymentModal .btn-primary');
            btn.innerHTML = 'ê²°ì œ ìš”ì²­ ì¤‘...';

            setTimeout(() => {
                isPaid = true;
                closePayment();
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                alert(`${method} ê²°ì œ ì„±ê³µ! ì‚¬ì£¼ì™•ì˜ ë¹„ê¸‰ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ğŸ‰`);
                document.getElementById('premium-lock').classList.add('hidden');
                document.getElementById('premium-content').classList.remove('hidden');
            }, 1000);
        }

        // Lotto Logic
        function drawLotto() {
            const btn = document.querySelector('#screen-lotto .cta-btn');
            const res = document.getElementById('lotto-result');
            const msg = document.getElementById('lotto-msg');

            btn.disabled = true;
            btn.innerText = "ì¶”ì¶œ ì¤‘...";

            let count = 0;
            const interval = setInterval(() => {
                // Shuffle effect
                const temp = [];
                for (let i = 0; i < 6; i++) temp.push(Math.floor(Math.random() * 45) + 1);
                res.innerHTML = temp.map(n => `<div class="lotto-ball" style="background:#555;">${n}</div>`).join('');
                count++;
                if (count > 10) {
                    clearInterval(interval);
                    finalizeLotto();
                }
            }, 100);
        }

        function finalizeLotto() {
            const numbers = new Set();
            while (numbers.size < 6) numbers.add(Math.floor(Math.random() * 45) + 1);
            const sorted = Array.from(numbers).sort((a, b) => a - b);

            const res = document.getElementById('lotto-result');
            res.innerHTML = sorted.map(n => {
                let colorClass = 'ball-50';
                if (n <= 10) colorClass = 'ball-10';
                else if (n <= 20) colorClass = 'ball-20';
                else if (n <= 30) colorClass = 'ball-30';
                else if (n <= 40) colorClass = 'ball-40';
                return `<div class="lotto-ball ${colorClass}">${n}</div>`;
            }).join('');

            document.getElementById('lotto-msg').innerText = "âœ¨ ë‹¹ì‹ ì˜ ì‚¬ì£¼ ê¸°ìš´ì´ ë‹´ê¸´ ë²ˆí˜¸ì…ë‹ˆë‹¤! âœ¨";
            document.querySelector('#screen-lotto .cta-btn').innerText = "ë‹¤ì‹œ ë½‘ê¸°";
            document.querySelector('#screen-lotto .cta-btn').disabled = false;

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#fbc02d', '#0288d1', '#d32f2f']
            });
        }
    </script>
</body>

</html>
